## translation metadata
# Based-On-Revision: 18753
# Translation-Priority: 2-medium
# Last-Translator: peihanru AT gmail.com

#include "head.wmi" TITLE="Tor: 中继配置指导" CHARSET="UTF-8"

<div class="center">

<div class="main-column">

<h1>配置一台 Tor 中继</h1>

<!-- BEGIN SIDEBAR -->
<div class="sidebar-left">
<h3>Config Steps</h3>
<ol>
<li><a href="<page docs/tor-doc-relay>#install">下载并安装</a></li>
<li><a href="<page docs/tor-doc-relay>#setup">配置</a></li>
<li><a href="<page docs/tor-doc-relay>#check">检查并确认</a></li>
<li><a href="<page docs/tor-doc-relay>#after">最终步骤</a></li>
</ol>
</div>
<!-- END SIDEBAR -->

<br />

<p>Tor 网络依靠志愿者们贡献带宽运行。运行中继的人越多，Tor 网络的速度就越快。
如果你的网络连接速度达到至少每秒 20KB，请运行一台中继以帮助 Tor。
我们有许多特性使得 Tor 中继的运行简单而方便，包括带宽的速率限制，
定制出口策略以避免滥用，以及对于动态 IP 地址的支持。</p>

<p>在互联网上的许多不同地方运行中继保护了 Tor 用户的安全。<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#RelayAnonymity">你
自身的匿名也能得到更好的保护</a>，因为站点不知道连接究竟来自你的电脑还是为他人传递。
</p>

<p>设置一台 Tor 中继既简单又方便
<ul>
<li>Tor 内建即支持<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#LimitBandwidth">速率限制</a>。
更进一步地，如果你不限制带宽但是想限制每天（或每星期、或每月）贡献的字节数，请查看<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#Hibernation">休眠特性</a>。
</li>
<li>每台 Tor 中继都有一套<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#RunARelayBut">出口策略</a>，
规定了这台中继都允许或禁止哪些类型的外部连接。如果你对于让其他人从你的中继
退出感到不安，你可以将它设置成仅允许连接到其他 Tor 中继。
</li>
<li>如果中继时常下线也没有什么关系。目录服务器会很快发现并停止公布它。
但是请不要过于频繁地下线，因为当中继下线时，会破坏正在使用这台中继的连接。
</li>
<li>我们能正确处理具有动态 IP 的中继——把“Address”配置选项留空即可，Tor 会尝试猜测。
</li>
<li>如果你的中继位于 NAT 后面而且不知道它的公网 IP（例如它的 IP 类似 192.168.x.y），
你需要设置端口转发。转发 TCP 连接的方法因系统而异，但是此 <a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#ServerForFirewalledClients">FAQ
条目</a>提供了如何实现这一目的的一些示例。
</li>
<li>你的中继将定期估计并公布它最近的带宽，高带宽的中继将因此吸引更多的用户。
但是低带宽的中继同样是有用的。
</li>
</ul>

<p>你能在几乎所有的操作系统上运行 Tor 中继，但是请查看此 <a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#RelayOS">FAQ
条目</a>以了解哪些操作系统更合适以及你可能会碰到的其他问题。
</p>

<hr />
<a id="zero"></a>
<a id="install"></a>
<h2><a class="anchor" href="#install">第一步：下载并安装 Tor</a></h2>
<br />

<p>开始前，你需要确认 Tor 已经正常运行。</p>

<p>对于 Windows 用户，这意味着至少完成 Windows 的 Tor 安装指导的<a
href="<page docs/tor-doc-windows>#installing">第一步</a>。Mac OS X 用户需要至少完成
OS X 的 Tor 安装指导的<a href="<page docs/tor-doc-osx>#installing">第一步</a>。
Linux/BSB/Unix 用户需要至少完成 Unix 的 Tor 安装指导的<a
href="<page docs/tor-doc-unix>#installing">第一步</a>。
</p>

<p>如果可以的话，你也许还应该将它作为客户端使用一段时间以确认 Tor 确实工作正常。
</p>

<hr />
<a id="setup"></a>
<h2><a class="anchor" href="#setup">第二步：将它设置成中继</a></h2>
<br />

<p>
1、检查你的时间是否正确。可能的话，与公共的时间服务器同步时间。
</p>

<p>
2、确认名字解析工作正常（意思是，你的机器能够正确解析 Internet 地址）。
</p>

<p>
3、配置中继最简单的办法是使用 Vidalia。更高级的方法是直接修改 torrc。
</p>

<blockquote>
<strong>简单配置</strong>：
<ul>
<li>鼠标右键点击任务栏中的 Vidalia 图标，选择<tt>控制面板</tt>。</li>
<li>点击<tt>设置中继</tt>。</li>
<li>选择 <tt>Tor 网络中继</tt>。</li>
<li>为中继输入一个昵称。（可选，输入联系信息。）</li>
<li>选择 <tt>Attempt to automatically configure port forwarding</tt>。
点击 <tt>Test</tt> 按钮检查是否能正常工作。如能正常工作继续往下配置；
否则请查看下面第 4 点关于防火墙的说明。
<!-- FIXME: 上面的两个GUI短语目前并没有翻译。--></li>
<li>转到<tt>带宽限制</tt>标签。选择一个你愿意为 Tor 用户提供的带宽。</li>
<li>转到<tt>服务策略</tt>标签。如果你同意 Tor 用户通过中继使用这些服务，什么都不用修改。
取消选择那些你不想提供的服务。如果你只想成为非出口的中继，取消选择所有服务。</li>
<li>点击<tt>确定</tt>按钮。请看下面的第二步以确认中继工作正常。</li>
</ul>

<strong>高级配置</strong>：
<ul>
<li>修改 torrc 的最后部分。（如需帮助，请查看<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#torrc">此 FAQ 条目</a>。）
请确认至少定义了 Nickname 和 ORPort 选项。需要的话创建 DataDirectory 并确认
这个目录的所有者是将要运行 Tor 的用户。<em>如果你打算运行多台中继——这太棒了——
但是请为所有中继的配置文件加入 <a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#MultipleRelays">MyFamily
选项</a>。</em></li>
</ul>
</blockquote>

<p>
4、如果你使用防火墙，请在防火墙上开出一个洞口以使得进入的连接能够到达配置的端口
（ORPort，如果设置的话，还有 DirPort）。请确认你允许所有的外出连接，这样你的
中继才能与其他 Tor 中继通信。
<!-- I'm always unable to figure out how to translate "incoming", "outgoing",
"inbound", "outbound" and the similar into proper Chinese terms. :( --> 
</p>

<p>
5、重启中继。如果<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#Logs">日志中有任何警告信息</a>，
想办法解决它们。
</p>

<p>
6、订阅 <a href="http://archives.seul.org/or/announce/">or-announce</a> 邮件列表。
该邮件列表流量非常小，它会在新的稳定版本发布时提醒你。你也可以考虑订阅 <a
href="http://archives.seul.org/or/talk/">or-talk</a>（高流量），新的开发版本
会在那儿公布。
</p>

<p>
7、检阅手册。最新稳定版本的<a href="<page tor-manual>">手册</a>提供了一个
客户端和中继所有可能配置选项的列表。如果你运行的是 Tor 的开发版本，
它的手册在<a href="<page tor-manual-dev>">这里</a>。
</p>

<hr />
<a id="check"></a>
<h2><a class="anchor" href="#check">第三步：确认它在工作</a></h2>
<br />

<p>一旦你的中继连接上了网络，它就会尝试检测能否从外部访问你所配置的端口。
这一过程最长可持续 20 分钟。请查看是否有“<tt>Self-testing indicates your ORPort
is reachable from the outside. Excellent.</tt>”这样的<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#Logs">日志条目</a>。
如果你没有看到这条消息，说明从外部不能访问你的中继——你应该重新检查防火墙设置，
检查测试的 IP 和端口是否正确，等等。
</p>

<p>当确认能从外部访问中继时，它会向目录服务器上传一个“服务器描述符（server
descriptor）”。客户端因此知道你的中继的地址、端口、公钥等。为了确认中继
正常工作，你可以<a href="http://moria.seul.org:9032/tor/status/authority">手动
下载一份网络状态</a>，从中查找你所配置的中继的名字。在获得最新的目录前，
你需要等待几秒钟的时间。</p>

<hr />
<a id="after"></a>
<h2><a class="anchor" href="#after">第四步：一旦它开始正常工作</a></h2>
<br />

<p>
我们也推荐以下的步骤：
</p>

<p>
8、阅读<a href="https://wiki.torproject.org/noreply/TheOnionRouter/OperationalSecurity">该文档</a>，
了解如何增强中继的安全性。
</p>

<p>
9、考虑你想要怎样的出口策略。默认情况下，中继允许访问多种流行的服务，但限制
一些可能招致滥用的服务（如端口 25）。你可能想要更宽松的限制，也可能想要更严格
的限制，请根据需要修改 torrc。
请阅读<a href="<page faq-abuse>#TypicalAbuses">使用默认的出口策略可能会遇到的问题</a>的
FAQ 条目。如果你选择了特别开放的出口策略，你还要确认你的 ISP 是否会同意你的选择。
如果你的中继有无法访问的资源（例如在一个受限的防火墙或内容过滤系统后面），请在
出口策略中明确地拒绝它们——否则其他 Tor 用户会受到同样的影响。
</p>

<p>
10、考虑速率限制。线缆调制解调器、DSL 和其他拥有非对称带宽（如下行速率大于上行速率）
的用户应将速率限制为较低的那个带宽，以避免拥塞。请查看<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#LimitBandwidth">有关
速率限制的 FAQ 条目</a>。
</p>

<p>
11、备份 Tor 中继的私钥（在 DataDirectory 目录里的“keys/secret_id_key”文件中）。
这是你的中继的“身份证”，你需要保证它的安全，这样就没有人能读取通过你的中继的流量了。
如果出于什么原因，你需要<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#UpgradeRelay">转移或还原
Tor 中继</a>，这是你需要保存的关键文件。
</p>

<p>
12、如果你掌控你的域名的名字服务器，请考虑将反向的 DND 主机名设置成“anonymous-relay”、
“proxy”或“tor-proxy”，这样当他人在他们的 Web 日志中看到你的服务器的地址时，
他们将更快地知道发生了什么。如果你在运行出口节点，请将 <a
href="https://tor-svn.freehaven.net/svn/tor/trunk/contrib/tor-exit-notice.html">Tor
出口注意</a>放到与主机同名的虚拟主机上，这么做会使你和你的 ISP 收到的滥用指控少很多。
</p>

<p>
13、如果你的计算机不在运行 Web 服务器，请考虑将 ORPort 改成 443，将 DirPort
改成 80。许多 Tor 用户由于防火墙的阻挡只能浏览 Web，这种修改使他们能够连接到你的
Tor 中继。Win32 中继直接在 torrc 里修改 ORPort 和 DirPort，然后重启即可。OS X
和 Unix 中继无法直接绑定这些端口（因为运行中继的用户不是 root），它们需要设置<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#ServerForFirewalledClients">端口
转发</a>以使得连接能够到达 Tor 中继。如果 80 端口和 443 端口已被占用，其他常用
的端口是 22、110 和 143。
</p>

<p>
14、如果你的 Tor 中继在同一 IP 地址运行其它服务——例如公开的 Web 服务器——请确认
Web 服务器允许来自本地主机的连接。这是因为（当用户访问你的网站时）Tor 客户端会
发现你的 Tor 中继是<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorFAQ#ExitEavesdroppers">访问
你的 Web 服务器的最安全的方式</a>，总是会建立一条终止于你的中继的电路。
如果你不想允许这种连接，你必须在出口策略中明确地拒绝它们。
</p>

<p>
15、（仅针对 Unix）。创建一个独立的用户运行中继。如果你安装的是 OS X 软件包、deb
软件包或者 rpm 软件包，这一步已经完成。在其他情况下，你可以自己动手完成这一步。
（Tor 中继不需要以 root 运行，因此不以 root 运行是一个好的实践。以一个“tor”用户运行
避免了 identd 和其他检查用户名的服务会带来的问题。如果你非常谨小慎微，你自然可以<a
href="https://wiki.torproject.org/noreply/TheOnionRouter/TorInChroot">将 Tor 置于
chroot jail 中</a>。）
</p>

<p>
16、（仅针对 Unix）。你的操作系统可能将每一进程能够打开的文件标识符的数目限制在
1024（甚至更少）。如果你计划运行一台快速的出口节点，这一数目也许不够。Linux 中，
你应该在 /etc/security/limits.conf 文件中添加一行，如“toruser hard nofile 8192”
（toruser 是运行 Tor 进程的用户），然后重新启动 Tor（如果 Tor 以软件包的方式
安装）或者登出再登陆（如果运行 Tor 的用户就是你）。
</p>

<p>
17、如果你是通过软件包或安装文件安装的 Tor，它可能会在系统启动时自动启动 Tor。
如果你是自源文件安装的 Tor，contrib/tor.sh 或者 contrib/torctl 中的初始脚本
也许对你有用。
</p>

<p>
当你修改了 Tor 的配置，请记得检查中继在配置修改以后依旧正常工作。
请确认你在 torrc 中设置了“ContactInfo”，这样当需要升级或者发生了什么问题时我们能与你取得联系。
如果你有疑问或者问题，请查看文档的<a href="<page documentation>#Support">获得支持</a>部分
或者从 tor-ops 信箱<a href="<page contact>">联系我们</a>。
感谢你为 Tor 网络成长做出的贡献！
</p>

<hr />

<p>如果你有改进本文档的建议，请<a href="../contact.html.zh-cn">告诉我们</a>。
谢谢！</p>

  </div><!-- #main -->
</div>

#include <foot.wmi>
