





## translation metadata
# Revision: $Revision$
# Translation-Priority: 3-low
#include "head.wmi" TITLE="Tor: Hidden Service Protocol" CHARSET="UTF-8"
<div class="main-column">

<h2>Tor: Скрытый Сервисный Протокол</h2>
<hr />

<p>
Tor предоставляет своим пользователям возможность скрывать их
месторасположение, и в то же время предлагает им различные сервисы,
например, веб публикации или сервер быстрого обмена сообщениями. Используя
"точки синхронизации" Tor, другие пользователи Tor могут подсоединяться к
этим скрытым сервисам, не имея возможности идентифицировать сетевые
характеристики других пользователей. На этой странице описаны технические
детали работы протокола точек синхронизации. Более подробную инструкцию
смотрите на нашей странице <a href="<page
docs/tor-hidden-service>">конфигурации скрытых сервисов</a>.
</p>

<p>
Прежде чем клиенты смогут подключиться к скрытому сервису, он должен заявить
о своем существовании в сети Tor. Поэтому сервис беспорядочно выбирает
некоторые ретрансляторы, создает цепи подключения к ним и запрашивает у них
выполнение функций в качестве <em>точек интродукции</em>, сообщая им свой
публичный код. Обратите внимание, что в следующих цифрах зеленые линии
являются цепями подключения, а не прямыми связями. При использовании полной
цепи подключения Tor трудно ассоциировать точку интродукции с IP-адресом
скрытого сервера. Сообщая точкам интродукции и другим участникам сети
идентификационные данных скрытого сервиса (его публичный код), мы не хотим,
раскрыть информацию о физическом местонахождении скрытого сервера
(IP-адрес).
</p>

# maybe add a speech bubble containing "PK" to Bob, because that's what
# Bob tells to his introduction points
<img alt="Tor hidden service step one" src="$(IMGROOT)/THS-1.png" />



<p>
Шаг второй: скрытый сервис собирает <em>описание скрытого сервиса</em>,
содержащее его публичный код и сводку по каждой точке интродукции, и
подписывает это описание своим личным ключом.  Он загружает это описание в
распространяемую хэш-таблицу. Описание будет получено клиентами,
запрашивающими XYZ.onion, где XYZ - это шестнадцатизначное имя, которое
является уникальным и генерируется с использованием публичного ключа
сервиса. После прохождения этого шага скрытый сервис установлен. 
</p>

<p>
Хотя использование автоматически генерируемого сервисного имени может
показаться непрактичным, оно служит важной цели: Все, включая точки
интродукции, директорию распространяемой хэш-таблицы и, конечно, клиентов,
могут убедиться в том, что они подключаются к верному скрытому
сервису. Смотрите также <a href="https://zooko.com/distnames.html"> гипотезу
Zooko</a>, согласно которой из Децентрализованного, Безопасного и
Значительного вы можете достичь не больше двух. Возможно, в один прекрасный
день кто-то применит <a
href="http://www.skyhunter.com/marcs/petnames/IntroPetNames.html">имя
любимой собаки</a> в качестве названия для скрытого сервиса?
</p>

# maybe replace "database" with "DHT"; further: how incorrect
# is it to *not* add DB to the Tor cloud, now that begin dir cells are in
# use?
<img alt="Tor hidden service step two" src="$(IMGROOT)/THS-2.png" />




<p>
Шаг третий: Клиент, который желает подключиться к скрытому сервису, должен
сначала узнать его адрес. После этого, клиент может инициировать установку
соединения, загрузив описание из распространяемой хэш-таблицы. Если есть
описание для XYZ.onion (скрытый сервис может находиться оффлайн или,
возможно, он давно покинул сеть, возможно также вы сделали опечатку в onion
адресе), то клиент получает набор точек интродукции и правильный публичный
код. Примерно в это же время, клиент создает цепь подключения к другому
случайно выбранному ретранслятору и просит его выступить в качестве
<em>точки синхронизации</em>, открывая ему "одноразовый" секрет.
</p>

# maybe add "cookie" to speech bubble, separated from the surrounded
# "IP1-3" and "PK"
<img alt="Tor hidden service step three" src="$(IMGROOT)/THS-3.png" />



<p>
Шаг четвертый: когда есть описание и точка синхронизации готова, клиент
предоставляет <em>вводное</em> сообщение (зашифрованное в публичном ключе
скрытого сервиса), вклющее адрес точки синхронизации и "одноразовый"
секрет. Клиент посылает это сообщение одному из пунктов вступления,
запрашивая его о доставке скрытому сервису. И снова общение происходит по
цепи Tor: никто не может послать приветственное послание на IP-адрес
клиента, и, таким образом, клиент остается анонимным.
</p>

<img alt="Tor hidden service step four" src="$(IMGROOT)/THS-4.png" />

<p>
Шаг пятый: Скрытый сервис расшифровывает послание клиента и находит в нем
адрес точки синхронизации и единовременный ключ. Сервис создает цепь
подключения к точке синхронизации и в сообщении посылает туда одноразовый
ключ.
</p>

<p>
At this point it is of special importance that the hidden service sticks to
the same set of <a
href="<wiki>TorFAQ#Whatsthisaboutentryguardformerlyknownashelpernodes">entry
guards</a> when creating new circuits. Otherwise an attacker could run his
own relay and force a hidden service to create an arbitrary number of
circuits in the hope that the corrupt relay is picked as entry node and he
learns the hidden server's IP address via timing analysis. This attack was
described by &Oslash;verlier and Syverson in their paper titled <a
href="http://freehaven.net/anonbib/#hs-attack06">Locating Hidden
Servers</a>.
</p>

# it should say "Bob connects to Alice's ..."
<img alt="Tor hidden service step five" src="$(IMGROOT)/THS-5.png" />


<p>
На последнем этапе, пункт встречи уведомляет клиента об успешной установке
соединения. После чего оба, клиент и скрытый сервис, могут использовать их
цепь подключения к точке синхронизации для связи друг с другом. Пункт
встречи просто ретранслирует (полностью зашифрованное) сообщение от клиента
к сервису и обратно.
</p>

<p>
Одной из причин, по которой не используется вступительная цепь для
действующей коммуникации, является то, что ни один ретранслятор не должен
быть ответственным за скрытый сервис. Именно поэтому точка синхронизации
никогда не получает информацию о подлинных данных скрытого сервиса.
</p>

<p>
В общем, полная связь между клиентом и скрытым сервисом состоит из 6
ретрансляторов: 3 из них были выбраны клиентом, где третий находился на
точке синхронизации, а другие 3 были выбраны скрытым сервисом.
</p>

<img alt="Tor hidden service step six" src="$(IMGROOT)/THS-6.png" />

<p>
Существуют более подробные описания протокола скрытых сервисов. Обратите
внимание на <a href="<svnprojects>design-paper/tor-design.pdf">Документ об
архитектуре сети Tor</a> для получения более углубленной информации об
архитектуре и <a href="<gitblob>doc/spec/rend-spec.txt">спецификациях точек
синхронизации</a> для форматов сообщений.
</p>

  </div>


#include <foot.wmi>
